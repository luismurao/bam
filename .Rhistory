m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- raster::raster(m1_path) > 0.01
m2 <- raster::raster(m2_path) >0.01
c1 <- class(m1)
c2 <- class(m2)
cl <- c("setA","raster")
if(c1 %in% cl){
stop("m1 should be of class raster or setA")
}
if(c2 %in% cl){
stop("m2 should be of class raster or setA")
}
if(c1 == "setA"){
m1 <- m1@sparse_model
}
if(c2 == "setA"){
m2 <- m2@sparse_model
}
if(c1 == "raster"){
m1 <- bam::model2sparse(m1)@sparse_model
}
if(c2 == "raster"){
m2 <- bam::model2sparse(m2)@sparse_model
}
m3 <- m1 * m2
A <- sum(m1)
m1
c1
c1 <- class(m1)
c2 <- class(m2)
cl <- c("setA","RasterLayer")
if(c1 %in% cl){
stop("m1 should be of class raster or setA")
}
if(c2 %in% cl){
stop("m2 should be of class raster or setA")
}
c1 <- class(m1)
c1
c1 %in% cl
c1 %in% cl
c1 %in% cl
c1 <- class(m1)
c2 <- class(m2)
cl <- c("setA","RasterLayer")
if(!c1 %in% cl){
stop("m1 should be of class raster or setA")
}
if(!c2 %in% cl){
stop("m2 should be of class raster or setA")
}
if(c1 == "setA"){
m1 <- m1@sparse_model
}
if(c2 == "setA"){
m2 <- m2@sparse_model
}
if(c1 == "raster"){
m1 <- bam::model2sparse(m1)@sparse_model
}
if(c2 == "raster"){
m2 <- bam::model2sparse(m2)@sparse_model
}
m3 <- m1 * m2
m3
c1 == "setA"
if(c1 == "RasterLayer"){
m1 <- bam::model2sparse(m1)@sparse_model
}
if(c2 == "RasterLayer"){
m2 <- bam::model2sparse(m2)@sparse_model
}
m3 <- m1 * m2
m3
A <- sum(m1)
A
B <- sum(m2)
B
int_AB <- sum(m3)
jcc <-int_AB/(A+B- int_AB)
jcc
library(bam)
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- raster::raster(m1_path) > 0.01
m2 <- raster::raster(m2_path) >0.01
jcc <- bam::jaccard(r1,r2)
print(jcc)
rm(list=ls())
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- raster::raster(m1_path) > 0.01
m2 <- raster::raster(m2_path) >0.01
jcc <- bam::jaccard(r1,r2)
jcc <- bam::jaccard(m1,m2)
print(jcc)
library(bam)
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- raster::raster(m1_path) > 0.01
m2 <- raster::raster(m2_path) >0.01
jcc <- bam::jaccard(r1,r2)
print(jcc)
rm(list=ls())
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- raster::raster(m1_path) > 0.01
m2 <- raster::raster(m2_path) >0.01
jcc <- bam::jaccard(m1,m2)
print(jcc)
print(jcc)
int_AB
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- raster::raster(m1_path) > 0.01
m2 <- raster::raster(m2_path) >0.01
jcc <- bam::jaccard(m1,m2)
print(jcc)
#' @export
#' @examples
#' m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
#'                        package = "bam")
#' m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
#'                        package = "bam")
#' m1 <- raster::raster(m1_path) > 0.01
#' m2 <- raster::raster(m2_path) >0.01
#' jcc <- bam::jaccard(m1,m2)
#' print(jcc)
jaccard <- function(m1,m2){
c1 <- class(m1)
c2 <- class(m2)
cl <- c("setA","RasterLayer")
if(!c1 %in% cl){
stop("m1 should be of class raster or setA")
}
if(!c2 %in% cl){
stop("m2 should be of class raster or setA")
}
if(c1 == "setA"){
m1 <- m1@sparse_model
}
if(c2 == "setA"){
m2 <- m2@sparse_model
}
if(c1 == "RasterLayer"){
m1 <- bam::model2sparse(m1)@sparse_model
}
if(c2 == "RasterLayer"){
m2 <- bam::model2sparse(m2)@sparse_model
}
m3 <- m1 * m2
A <- sum(m1)
B <- sum(m2)
int_AB <- sum(m3)
jcc <-int_AB/(A+B- int_AB)
return(jcc)
}
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- raster::raster(m1_path) > 0.01
m2 <- raster::raster(m2_path) >0.01
jcc <- bam::jaccard(m1,m2)
print(jcc)
t1 <- system.time({
r1 <- raster("inst/extdata/conejos/Lepus_othus_cont.tif") > 0.01
r2 <- raster("inst/extdata/conejos/Brachylagus_idahoensis_cont.tif") >0.01
r3 <- r1+ r2
A1 <- which(r1[]==1)
B1 <- which(r2[]==1)
int_AB1 <- intersect(A1,B1)
b <-length(int_AB1)/(length(A1)+length(B1) - length(int_AB1))
})
t1
t2 <- system.time({
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- raster::raster(m1_path) > 0.01
m2 <- raster::raster(m2_path) >0.01
jcc <- bam::jaccard(m1,m2)
print(jcc)
})
t2 <- system.time({
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- raster::raster(m1_path) > 0.01
m2 <- raster::raster(m2_path) >0.01
jcc <- bam::jaccard(m1,m2)
#print(jcc)
})
t2
t1 <- system.time({
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
r1 <- raster::raster(m1_path) > 0.01
r2 <- raster::raster(m2_path) >0.01
r3 <- r1+ r2
A1 <- which(r1[]==1)
B1 <- which(r2[]==1)
int_AB1 <- intersect(A1,B1)
b <-length(int_AB1)/(length(A1)+length(B1) - length(int_AB1))
})
t1
t2 <- system.time({
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- raster::raster(m1_path) > 0.01
m2 <- raster::raster(m2_path) >0.01
jcc <- bam::jaccard(m1,m2)
#print(jcc)
})
t2
t1 <- system.time({
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
r1 <- raster::raster(m1_path) > 0.01
r2 <- raster::raster(m2_path) >0.01
r3 <- r1+ r2
A1 <- which(r1[]==1)
B1 <- which(r2[]==1)
int_AB1 <- intersect(A1,B1)
b <-length(int_AB1)/(length(A1)+length(B1) - length(int_AB1))
})
t1
t2 <- system.time({
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- raster::raster(m1_path) > 0.01
m2 <- raster::raster(m2_path) >0.01
jcc <- bam::jaccard(m1,m2)
#print(jcc)
})
t2
t2 <- system.time({
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- raster::raster(m1_path) > 0.01
m2 <- raster::raster(m2_path) >0.01
jcc <- bam::jaccard(m1,m2)
#print(jcc)
})
t2
t1 <- system.time({
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
r1 <- raster::raster(m1_path) > 0.01
r2 <- raster::raster(m2_path) >0.01
r3 <- r1+ r2
A1 <- which(r1[]==1)
B1 <- which(r2[]==1)
int_AB1 <- intersect(A1,B1)
b <-length(int_AB1)/(length(A1)+length(B1) - length(int_AB1))
})
t1
m1 <- bam::model2sparse(raster::raster(m1_path) > 0.01)
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- bam::model2sparse(raster::raster(m1_path) > 0.01)
m2 <- bam::model2sparse(raster::raster(m2_path) >0.01)
t2 <- system.time({
jcc <- bam::jaccard(m1,m2)
#print(jcc)
})
t2
t2
t2
m2 <- bam::model2sparse(raster::raster(m2_path) >0.01)
t2 <- system.time({
jcc <- bam::jaccard(m1,m2)
#print(jcc)
})
t2
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
r1 <- raster::raster(m1_path) > 0.01
r2 <- raster::raster(m2_path) >0.01
r3 <- r1+ r2
t1 <- system.time({
A1 <- which(r1[]==1)
B1 <- which(r2[]==1)
int_AB1 <- intersect(A1,B1)
b <-length(int_AB1)/(length(A1)+length(B1) - length(int_AB1))
})
t1
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
r1 <- raster::raster(m1_path) > 0.01
r2 <- raster::raster(m2_path) >0.01
r3 <- r1+ r2
t1 <- system.time({
A1 <- which(r1[]==1)
B1 <- which(r2[]==1)
int_AB1 <- intersect(A1,B1)
b <-length(int_AB1)/(length(A1)+length(B1) - length(int_AB1))
})
r3
t1
t2 <- system.time({
jcc <- bam::jaccard(m1,m2)
#print(jcc)
})
t2
jcc=b
t1 <- system.time({
A1 <- which(r1[]==1)
B1 <- which(r2[]==1)
int_AB1 <- intersect(A1,B1)
b <-length(int_AB1)/(length(A1)+length(B1) - length(int_AB1))
})
m1_path <- system.file("extdata/conejos/Lepus_othus_cont.tif",
package = "bam")
m2_path <- system.file("extdata/conejos/Brachylagus_idahoensis_cont.tif",
package = "bam")
m1 <- bam::model2sparse(raster::raster(m1_path) > 0.01)
m2 <- bam::model2sparse(raster::raster(m2_path) >0.01)
t2 <- system.time({
jcc <- bam::jaccard(m1,m2)
#print(jcc)
})
jcc==b
jcc
b
library(bam)
rm(list=ls())
Sys.setenv('_R_CHECK_SYSTEM_CLOCK_' = 0)
Sys.which(Sys.getenv("R_QPDF", "qpdf"))
Sys.getenv("PATH")
Sys.which(Sys.getenv("R_QPDF", "qpdf"))
library(bam)
?jaccard
library(bam)
set.seed(111)
pam <- matrix(rbinom(10000,1,0.5),nrow = 100,ncol = 1000)
rdivan <- diversity_range_analysis(pam=pam,parallel = FALSE,
return_null_dfield=TRUE)
bam::plot(rdivan,plot_type="diversity_range")
# Ahora si el codigo del analisis
rm(list=ls())
setwd("C:/Users/l916o895/Dropbox/TeoriadeBAM")
pam1 <- rio::import("IUCN_Mammals_NA.csv")
mat=as.matrix(pam1[,-c(1:3)])
j=which(colSums(mat)>0)
mat2=mat[,j]
i=which(rowSums(mat2)>0)
mat3=mat2[i,]
xys <- as.matrix(pam1[i,2:3])
library(bam)
t1 <- system.time({
rdiv <- bam::diversity_range_analysis(pam = mat3,xy_mat = xys,
niter = 500,return_null_dfield = TRUE,
parallel = TRUE,
n_cores = 4)
})
t1 # tiempo en el que corrio las 500 simulaciones
rdiv
rdiv@dispersion_field
rdiv
x11()
bam::plot(rdiv,plot_type="diversity_range_map",asp=1)
x11()
bam::plot(rdiv,plot_type="diversity_range")
library(bam)
library(bam)
pam <- matrix(rbinom(10000,1,0.5),nrow = 100,ncol = 1000)
rdivan <- diversity_range_analysis(pam=pam,parallel = FALSE,
return_null_dfield=TRUE)
bam::plot(rdivan,plot_type="diversity_range")
rdivan@nsites
x=rdiv
#slotsin <- methods::slotNames(x)
#zeros_alpha <- which(x@alpha ==0)
#zeros_disperfield <- which(x@dispersion_field==0)
nsites <- x@nsites
nsps <- x@nsps
nsites
nsps
rm(list=ls())
set.seed(111)
pam <- matrix(rbinom(10000,1,0.5),nrow = 100,ncol = 1000)
rdivan <- diversity_range_analysis(pam=pam,parallel = FALSE,
return_null_dfield=TRUE)
rdivan
rdivan@nsites
x=rdivan
#slotsin <- methods::slotNames(x)
#zeros_alpha <- which(x@alpha ==0)
#zeros_disperfield <- which(x@dispersion_field==0)
nsites <- x@nsites
nsps <- x@nsps
if(nsites>0){
#cols <- c("#000000","#F6BDC0",
#         "#F07470","#BBDFFA",
#         "#DC1C13","#6987D5",
#        "#1727AE")
cols <- c("#000000","#F6BDC0",
"#F1A13A","#BBDFFA",
"#DC1C13","#6987D5",
"#1727AE")
names(cols) <- c("Random","HE/LR",
"HE/IR","LE/LR",
"HE/HR","LE/IR",
"LE/HR")
COLORES<- cols
COLORES <- COLORES[c(1:3,5,4,6,7)]
if(is.null(pch)){
pch <- 19
}
if("diversity_range" %in% plot_type){
alpha_norm <- x@alpha/nsps
dispersion_field <- x@dispersion_field/nsps
alpha_st <- x@alpha/x@nsps
betty <- round(1/mean(alpha_st),3);
fistprom <-x@dispersion_field/x@alpha;
rho  <-alpha_st*(fistprom-1/betty);
am <- min(alpha_st)
aM <- max(alpha_st)
fm <- min(x@dispersion_field,na.rm = T)/nsites
fM <- max(x@dispersion_field,na.rm =T)/nsites
rhom  <- min(rho,na.rm = T)
rhoM <- max(rho,na.rm = T)
vx <- c(am,aM,aM,am)
vy <- c(rhom+am/betty,rhom+aM/betty,
rhoM+aM/betty,rhoM+am/betty)
if(is.null(col)){
col <- x@diversity_range_colors
}
if(is.null(xlab)){
xlab <- expression(alpha)
}
if(is.null(ylab)){
ylab <- "Dispersion field"
}
xmin1<- 0.97*min(vx)
xmax1 <- 1.03*max(vx)
ymin1 <- 0.97*min(vy)
ymax1 <- 1.03*max(vy)
plot(alpha_norm,dispersion_field,xlim=c(xmin1,xmax1),
ylim=c(ymin1,ymax1),
xlab=xlab,ylab=ylab,pch=pch,col=col,...)
graphics::lines(graphics::polygon(vx,vy));
if(legend){
graphics::legend(legend_position,
legend = names(COLORES),
pch =pch_legend,
col = COLORES,bty = "n",...)
}
}
if("alpha" %in% plot_type && raster::hasValues(x@alpha_raster)){
raster::plot(x@alpha_raster,...)
}
if("dispersion_field" %in% plot_type &&
raster::hasValues(x@dispersion_field_raster)){
raster::plot(x@dispersion_field_raster,...)
}
if("diversity_range_map" %in% plot_type &&
raster::hasValues(x@diversity_range_raster)){
if(is.null(col)){
col <- x@diversity_range
}
else{
col <- rev(grDevices::terrain.colors(256))
}
raster::plot(x@diversity_range_raster,col=col,legend=FALSE,...)
if(legend){
graphics::legend(legend_position,legend = names(COLORES),
pch=15,col = COLORES,bty = "n",...)
}
}
if("diversity_range_map" %in% plot_type &&
!raster::hasValues(x@diversity_range_raster) &&
nrow(x@xy_coordinates) == nsites){
plot(x@xy_coordinates,col=x@diversity_range_colors,pch=15)
graphics::legend("bottomleft",legend = names(COLORES),
pch=15,col = COLORES,bty = "n")
}
}
library(bam)
library(bam)
